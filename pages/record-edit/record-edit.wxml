<!-- pages/record-edit/record-edit.wxml -->
<view class="container">
  <!-- å¤´éƒ¨æ“ä½œæ  -->
  <view class="header">
    <view class="header-left">
      <button class="btn-cancel" bindtap="onCancel">å–æ¶ˆ</button>
    </view>
    <view class="header-title">æ·»åŠ è®°å½•</view>
    <view class="header-right">
      <button class="btn-save {{!content ? 'disabled' : ''}}" bindtap="onSave" disabled="{{!content}}">ä¿å­˜</button>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="main-content">
    <!-- å® ç‰©é€‰æ‹© -->
    <view class="section pet-selector" wx:if="{{pets.length > 1}}">
      <view class="section-title">é€‰æ‹©å® ç‰©</view>
      <view class="pet-list">
        <block wx:for="{{pets}}" wx:key="petId">
          <view 
            class="pet-item {{selectedPetId === item.petId ? 'active' : ''}}"
            data-pet-id="{{item.petId}}"
            bindtap="onSelectPet"
          >
            <image class="pet-avatar" src="{{item.avatar || '/images/default-pet.png'}}" />
            <text class="pet-name">{{item.name}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- è®°å½•ç±»å‹é€‰æ‹© -->
    <view class="section type-selector">
      <view class="section-title">è®°å½•ç±»å‹</view>
      <view class="type-list">
        <view 
          class="type-item {{recordType === 'diary' ? 'active' : ''}}" 
          data-type="diary"
          bindtap="onSelectType"
        >
          <text class="type-icon">ğŸ“</text>
          <text class="type-name">æ—¥è®°</text>
        </view>
        <view 
          class="type-item {{recordType === 'health' ? 'active' : ''}}" 
          data-type="health"
          bindtap="onSelectType"
        >
          <text class="type-icon">ğŸ¥</text>
          <text class="type-name">å¥åº·</text>
        </view>
        <view 
          class="type-item {{recordType === 'activity' ? 'active' : ''}}" 
          data-type="activity"
          bindtap="onSelectType"
        >
          <text class="type-icon">ğŸª</text>
          <text class="type-name">æ´»åŠ¨</text>
        </view>
      </view>
    </view>

    <!-- å¥åº·è®°å½•é¢å¤–ä¿¡æ¯ -->
    <view class="section health-extra" wx:if="{{recordType === 'health'}}">
      <view class="section-title">å¥åº·é¡¹ç›®</view>
      <picker 
        class="health-picker" 
        range="{{healthTypes}}" 
        range-key="name"
        value="{{healthTypeIndex}}"
        bindchange="onHealthTypeChange"
      >
        <view class="picker-content">
          <text class="picker-text">{{healthTypes[healthTypeIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- å†…å®¹è¾“å…¥åŒºåŸŸ -->
    <view class="section content-input">
      <textarea 
        class="content-textarea" 
        placeholder="è®°å½•ä¸‹æ­¤åˆ»çš„å¿ƒæƒ…æˆ–é‡è¦ä¿¡æ¯..." 
        placeholder-class="placeholder"
        maxlength="500"
        value="{{content}}"
        bindinput="onContentInput"
        show-confirm-bar="{{false}}"
        auto-height
      ></textarea>
      <view class="word-count">{{content.length}}/500</view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <view class="section image-upload">
      <view class="section-title">æ·»åŠ å›¾ç‰‡ ({{images.length}}/9)</view>
      <view class="image-list">
        <!-- å·²ä¸Šä¼ çš„å›¾ç‰‡ -->
        <block wx:for="{{images}}" wx:key="*this" wx:for-item="image" wx:for-index="index">
          <view class="image-item">
            <image class="image-preview" src="{{image}}" mode="aspectFill" />
            <view class="image-remove" data-index="{{index}}" bindtap="onRemoveImage">Ã—</view>
          </view>
        </block>
        
        <!-- æ·»åŠ å›¾ç‰‡æŒ‰é’® -->
        <view class="image-item add-image" wx:if="{{images.length < 9}}" bindtap="onAddImage">
          <view class="add-icon">+</view>
          <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨è®°å½•é¢å¤–ä¿¡æ¯ -->
    <view class="section activity-extra" wx:if="{{recordType === 'activity'}}">
      <view class="section-title">å…³è”æ´»åŠ¨</view>
      <picker 
        class="activity-picker" 
        range="{{activities}}" 
        range-key="title"
        value="{{activityIndex}}"
        bindchange="onActivityChange"
      >
        <view class="picker-content">
          <text class="picker-text">{{activities[activityIndex] ? activities[activityIndex].title : 'é€‰æ‹©æ´»åŠ¨'}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- åŠ è½½é®ç½© -->
  <view class="loading-mask" wx:if="{{isLoading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">ä¿å­˜ä¸­...</text>
    </view>
  </view>
</view>