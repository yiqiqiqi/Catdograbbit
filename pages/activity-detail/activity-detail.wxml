<!-- pages/activity-detail/activity-detail.wxml -->
<view class="container">
  <!-- æ´»åŠ¨å°é¢ -->
  <view class="activity-cover">
    <image class="cover-image" src="{{activity.coverImage || '/images/default-activity.jpg'}}" mode="aspectFill" />
    <view class="cover-overlay">
      <view class="activity-status {{activity.status}}">
        {{getStatusText(activity.status)}}
      </view>
      <view class="cover-content">
        <text class="activity-title">{{activity.title}}</text>
        <view class="activity-stats">
          <text class="stat">â­ {{activity.rating || '4.8'}}</text>
          <text class="stat">â¤ï¸ {{activity.likeCount || 0}}</text>
          <text class="stat">ğŸ‘¥ {{activity.currentParticipants || 0}}/{{activity.maxParticipants || 'ä¸é™'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨ä¿¡æ¯ -->
  <view class="section activity-info">
    <view class="info-item">
      <text class="info-icon">ğŸ“…</text>
      <view class="info-content">
        <text class="info-label">æ´»åŠ¨æ—¶é—´</text>
        <text class="info-text">{{formatActivityTime(activity.startTime, activity.endTime)}}</text>
      </view>
    </view>

    <view class="info-item">
      <text class="info-icon">ğŸ“</text>
      <view class="info-content">
        <text class="info-label">æ´»åŠ¨åœ°ç‚¹</text>
        <text class="info-text">{{activity.location}}</text>
        <text class="info-address">{{activity.address}}</text>
      </view>
      <text class="info-action" bindtap="onViewLocation">æŸ¥çœ‹åœ°å›¾</text>
    </view>

    <view class="info-item">
      <text class="info-icon">ğŸ‘¤</text>
      <view class="info-content">
        <text class="info-label">ç»„ç»‡æ–¹</text>
        <text class="info-text">{{activity.organizer || 'å® ç‰©æˆé•¿æ—¥è®°'}}</text>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨æè¿° -->
  <view class="section activity-description">
    <view class="section-title">æ´»åŠ¨ä»‹ç»</view>
    <text class="description-content">{{activity.description}}</text>
    
    <!-- æ´»åŠ¨å›¾ç‰‡ -->
    <view class="activity-images" wx:if="{{activity.images && activity.images.length > 0}}">
      <block wx:for="{{activity.images}}" wx:key="*this">
        <image class="activity-image" src="{{item}}" mode="aspectFill" bindtap="onPreviewImage" data-src="{{item}}" />
      </block>
    </view>
  </view>

  <!-- æŠ¥åä¿¡æ¯ -->
  <view class="section participation-info" wx:if="{{activity.joined}}">
    <view class="section-title">æˆ‘çš„æŠ¥å</view>
    <view class="participation-list">
      <block wx:for="{{joinedPets}}" wx:key="petId">
        <view class="participation-item">
          <image class="pet-avatar" src="{{item.avatar || '/images/default-pet.png'}}" />
          <text class="pet-name">{{item.name}}</text>
          <text class="participation-status">å·²æŠ¥å</text>
        </view>
      </block>
    </view>
  </view>

  <!-- å‚ä¸ç”¨æˆ· -->
  <view class="section participants" wx:if="{{participants.length > 0}}">
    <view class="section-header">
      <text class="section-title">å·²æŠ¥åç”¨æˆ· ({{participants.length}})</text>
    </view>
    <view class="participants-list">
      <block wx:for="{{participants}}" wx:key="userId">
        <view class="participant-item">
          <image class="user-avatar" src="{{item.avatar || '/images/default-avatar.png'}}" />
          <text class="user-name">{{item.nickname}}</text>
          <text class="pets-count">{{item.pets.length}}åªå® ç‰©</text>
        </view>
      </block>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="btn-like {{activity.liked ? 'liked' : ''}}" bindtap="onLikeActivity">
      <text class="like-icon">{{activity.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      <text class="like-text">å–œæ¬¢</text>
    </button>
    <button 
      class="btn-join {{activity.status !== 'open' ? 'disabled' : ''}} {{activity.joined ? 'joined' : ''}}"
      bindtap="onJoinActivity"
      disabled="{{activity.status !== 'open'}}"
    >
      {{getJoinButtonText(activity)}}
    </button>
  </view>

  <!-- æŠ¥åå¼¹çª— -->
  <view class="join-modal" wx:if="{{showJoinModal}}">
    <view class="modal-mask" bindtap="onCloseModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©å‚ä¸å® ç‰©</text>
        <text class="modal-close" bindtap="onCloseModal">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="pets-list">
          <block wx:for="{{availablePets}}" wx:key="petId">
            <view 
              class="pet-select-item {{selectedPets.includes(item.petId) ? 'selected' : ''}}"
              data-pet-id="{{item.petId}}"
              bindtap="onTogglePet"
            >
              <image class="pet-avatar" src="{{item.avatar || '/images/default-pet.png'}}" />
              <text class="pet-name">{{item.name}}</text>
              <text class="check-icon">{{selectedPets.includes(item.petId) ? 'âœ“' : ''}}</text>
            </view>
          </block>
        </view>
        
        <view class="modal-tips" wx:if="{{availablePets.length === 0}}">
          <text class="tips-text">æš‚æ— å¯ç”¨å® ç‰©</text>
          <text class="tips-subtext">è¯·å…ˆæ·»åŠ å® ç‰©å†æŠ¥åæ´»åŠ¨</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-cancel" bindtap="onCloseModal">å–æ¶ˆ</button>
        <button 
          class="btn-confirm {{selectedPets.length === 0 ? 'disabled' : ''}}"
          bindtap="onConfirmJoin"
          disabled="{{selectedPets.length === 0}}"
        >
          ç¡®è®¤æŠ¥å ({{selectedPets.length}})
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>